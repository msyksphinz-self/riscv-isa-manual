\begin{comment}
\chapter{``Zam'' Standard Extension for Misaligned Atomics, v0.1}
\end{comment}
\chapter{ミスアラインアトミックのための``Zam''標準拡張, v0.1}
\label{sec:zam}

\begin{comment}
This chapter defines the ``Zam'' extension, which extends the ``A'' extension by standardizing support for misaligned atomic memory operations (AMOs).
On platforms implementing ``Zam'', misaligned AMOs need only execute atomically with respect
to other accesses (including non-atomic loads and stores) to the same address and of the same size.
More precisely, execution environments implementing ``Zam'' are subject to the following axiom:
\newcommand{\misalignedatomicityaxiom}{If $r$ and $w$ are paired misaligned load and store instructions from a hart $h$ with the same address and of the same size, then there can be no store instruction $s$ from a hart other than $h$ with the same address and of the same size as $r$ and $w$ such that a store operation generated by $s$ lies in between memory operations generated by $r$ and $w$ in the global memory order.  Furthermore, there can be no load instruction $l$ from a hart other than $h$ with the same address and of the same size as $r$ and $w$ such that a load operation generated by $l$ lies between two memory operations generated by $r$ or by $w$ in the global memory order.}
\end{comment}
本章では、``Zam''拡張を定義します。
この拡張は``A''拡張をさらに拡張し、ミスアラインド・アトミック・メモリ操作(AMO)のサポートを標準化したものです。
Zamを実装したプラットフォームでは、同じアドレス、同じサイズの他のアクセス(非アトミックなロードとストアを含む)に対して、
ミスアラインされたAMOがアトミックに実行される必要があります。
より正確には、``Zam''を実装した実行環境は、以下の公理に従います:
\newcommand{\misalignedatomicityaxiom}{$r$と$w$が同じアドレスで同じサイズのhart$h$からの対になったミスアラインドのロード命令とストア命令であるとすると、$r$と$w$と同じアドレスで同じサイズのhart以外からのストア命令$s$が存在せず、$s$によって生成されたストアオペレーションがグローバルメモリの順序で$r$と$w$によって生成されたメモリオペレーションの間に位置するようなことがあります。 さらに、$h$以外のhartからのロード命令$l$は、$r$、$w$と同じアドレス、同じサイズで、$l$によって生成されたロード操作が、グローバルメモリ順で$r$または$w$によって生成された2つのメモリ操作の間に位置するような命令は存在しません。}

\vspace{-0.2in}
\begin{comment}
\paragraph{Atomicity Axiom for misaligned atomics}
\end{comment}
\paragraph{ミスアラインアトミックのためのアトミック性公理}
\label{rvwmo:ax:misaligned}
\misalignedatomicityaxiom

\begin{comment}
This restricted form of atomicity is intended to balance the needs of applications which require support for misaligned atomics and the ability of the implementation to actually provide the necessary degree of atomicity.
\end{comment}
この制限付きのアトミック性は、ミスアラインアトミックをサポートすることを必要とするアプリケーションのニーズと、
必要なアトミック性を実際に提供する実装の能力とのバランスをとることを目的としています。

\begin{comment}
Aligned instructions under ``Zam'' continue to behave as they normally do under RVWMO.
\end{comment}
なお、``Zam''のアラインド・命令は、RVWMOの場合と同様に動作します。

\begin{commentary}
  \begin{comment}
    The intention of ``Zam'' is that it can be implemented in one of two ways:
  \end{comment}
  ``Zam''の意図は、2つの方法のいずれかで実装できることです。
  \begin{comment}
  \begin{enumerate}
    \item On hardware that natively supports atomic misaligned accesses to the address and size in question (e.g., for misaligned accesses within a single cache line): by simply following the same rules that would be applied for aligned AMOs.
    \item On hardware that does not natively support misaligned accesses to the address and size in question: by trapping on all instructions (including loads) with that address and size and executing them (via any number of memory operations) inside a mutex that is a function of the given memory address and access size.  AMOs may be emulated by splitting them into separate load and store operations, but all preserved program order rules (e.g., incoming and outgoing syntactic dependencies) must behave as if the AMO is still a single memory operation.
  \end{enumerate}
  \end{comment}

  \begin{enumerate}
  \item 対象となるアドレスとサイズへのアトミックなずれたアクセスをネイティブにサポートするハードウェアでは(例：1つのキャッシュライン内でのずれたアクセス)、アライメントされたAMOに適用されるのと同じルールに従うだけです。
  \item 対象となるアドレスとサイズへのミスアラインド・アクセスをネイティブにサポートしていないハードウェアでは、対象となるアドレスとサイズを持つすべての命令(ロードを含む)をトラップし、与えられたメモリアドレスとアクセスサイズの関数であるミューテックス内で(任意の数のメモリ操作を介して)実行します。AMOは、ロードとストアの操作に分割してエミュレートすることができますが、保存されているすべてのプログラム順序規則(入力および出力の構文依存性など)は、AMOが依然として1つのメモリ操作であるかのように動作しなければなりません。
  \end{enumerate}
\end{commentary}
